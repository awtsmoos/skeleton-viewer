
// B"H
import { Primitives } from '../Primitives.js';
import { GeoUtils } from '../GeoUtils.js';

const CHAR_MAP = {
    'A': [0x2, 0x5, 0x7, 0x5, 0x5], // 3x5 bitmasks
    'B': [0x6, 0x5, 0x6, 0x5, 0x6],
    'C': [0x3, 0x4, 0x4, 0x4, 0x3],
    'D': [0x6, 0x5, 0x5, 0x5, 0x6],
    'E': [0x7, 0x4, 0x6, 0x4, 0x7],
    'F': [0x7, 0x4, 0x6, 0x4, 0x4],
    'G': [0x3, 0x4, 0x5, 0x5, 0x3],
    'H': [0x5, 0x5, 0x7, 0x5, 0x5],
    'I': [0x7, 0x2, 0x2, 0x2, 0x7],
    'J': [0x1, 0x1, 0x1, 0x5, 0x2],
    'K': [0x5, 0x5, 0x6, 0x5, 0x5],
    'L': [0x4, 0x4, 0x4, 0x4, 0x7],
    'M': [0x5, 0x7, 0x5, 0x5, 0x5],
    'N': [0x6, 0x5, 0x5, 0x5, 0x3],
    'O': [0x2, 0x5, 0x5, 0x5, 0x2],
    'P': [0x6, 0x5, 0x6, 0x4, 0x4],
    'Q': [0x2, 0x5, 0x5, 0x6, 0x3],
    'R': [0x6, 0x5, 0x6, 0x5, 0x5],
    'S': [0x3, 0x4, 0x2, 0x1, 0x6],
    'T': [0x7, 0x2, 0x2, 0x2, 0x2],
    'U': [0x5, 0x5, 0x5, 0x5, 0x2],
    'V': [0x5, 0x5, 0x5, 0x5, 0x2],
    'W': [0x5, 0x5, 0x5, 0x7, 0x5],
    'X': [0x5, 0x5, 0x2, 0x5, 0x5],
    'Y': [0x5, 0x5, 0x2, 0x2, 0x2],
    'Z': [0x7, 0x1, 0x2, 0x4, 0x7],
    '0': [0x2, 0x5, 0x5, 0x5, 0x2],
    '1': [0x2, 0x6, 0x2, 0x2, 0x7],
    '2': [0x6, 0x1, 0x2, 0x4, 0x7],
    '3': [0x6, 0x1, 0x2, 0x1, 0x6],
    '4': [0x5, 0x5, 0x7, 0x1, 0x1],
    '5': [0x7, 0x4, 0x6, 0x1, 0x6],
    '6': [0x3, 0x4, 0x6, 0x5, 0x2],
    '7': [0x7, 0x1, 0x1, 0x1, 0x1],
    '8': [0x2, 0x5, 0x2, 0x5, 0x2],
    '9': [0x2, 0x5, 0x3, 0x1, 0x2],
    '-': [0x0, 0x0, 0x7, 0x0, 0x0],
    '.': [0x0, 0x0, 0x0, 0x0, 0x2],
    ' ': [0x0, 0x0, 0x0, 0x0, 0x0]
};

export const FontGen = {
    createText: (text = "HELLO", scale = 1.0) => {
        const geos = [];
        const voxel = Primitives.createCube();
        const str = text.toUpperCase();
        
        let offsetX = 0;
        
        for(let i=0; i<str.length; i++) {
            const char = str[i];
            const mask = CHAR_MAP[char] || CHAR_MAP[' '];
            
            // Draw 3x5 grid
            for(let y=0; y<5; y++) {
                // mask[y] contains 3 bits (e.g. 101 = 5)
                const row = mask[y];
                for(let x=0; x<3; x++) {
                    // Check bit (2-x)
                    if ((row >> (2-x)) & 1) {
                         // Flip Y so 0 is top
                         geos.push(GeoUtils.transform(voxel, 
                             offsetX + (x*0.2*scale), 
                             (4-y)*0.2*scale, 
                             0, 
                             0.1*scale, 0.1*scale, 0.1*scale
                         ));
                    }
                }
            }
            offsetX += 0.8 * scale; // Kerning
        }
        
        return GeoUtils.merge(geos);
    }
};
